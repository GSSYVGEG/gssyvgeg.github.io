## spring security

### 依赖

```xml
<dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

### 基本配置

+ 建立配置类，继承于WebSecurityConfigurerAdapter

+ 接着重写configure(HttpSecurity http)方法

  ~~~java
  @Configuration
  public class ItbengSecurityConfig extends WebSecurityConfigurerAdapter {
      @Bean
      public PasswordEncoder passwordEncoder(){
          //此处使用了spring security的BCrypt加盐加密方式。
          //如需其他加密方式，如md5等，可以在此方法内实现。
          return new BCryptPasswordEncoder();
      }
  
  
      @Override
      protected void configure(HttpSecurity http) throws Exception {
          http
                  .formLogin()
  
                  .and().authorizeRequests()
                  .antMatchers(HttpMethod.GET,"/api/word").permitAll()
                  .anyRequest()
                  .authenticated();
      }
  }
  ~~~

  

### 自定义表单认证逻辑

+ 建立类，实现UserDetailsService接口，并加入spring组件。

  校对从前端收到user数据，与数据库中的用户名密码做比对.

  可以自己实现UserDetails接口，在自定义的实现类里写好校验逻辑，例如：判断用户是否被冻结、密码是否过期等等

  + 注意UserDetails实体类对象中的密码必须为密文，否则spring security会报异常：java.lang.IllegalArgumentException: There is no PasswordEncoder mapped for the id "null"
  + SpringBoot2.0抛弃了原来的NoOpPasswordEncoder，要求用户保存的密码必须要使用加密算法后存储，在登录验证的时候Security会将获得的密码在进行编码后再和数据库中加密后的密码进行对比
  + 参考：<https://blog.csdn.net/SWPU_Lipan/article/details/80586054>

```java
@Component
public class UserDetailService implements UserDetailsService {
    @Autowired
    private UserMapper userMapper;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //从数据库中查出对应username的用户信息
        UserExample userExample = new UserExample();
        userExample.createCriteria().andUsernameEqualTo(username);
        List<User> result = userMapper.selectByExample(userExample);
        System.out.println(result.get(0));
        //查询结果唯一，并组装成UserDetails的实现类对象
        if (result.size() == 1){
            User userDb = result.get(0);
            return new org.springframework.security.core.userdetails.User(
                    username,
                    userDb.getPassword(),
                    AuthorityUtils.commaSeparatedStringToAuthorityList("admin"));
        }else {
            throw new UsernameNotFoundException("用户名不存在");
        }
    }
}
```

